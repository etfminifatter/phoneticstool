# Excel单词音标生成器

## 项目概述
这是一个简单的在线工具，可以处理Excel文件中的英文单词，自动生成对应的英式和美式音标，并将结果导出为Excel格式。本工具为纯前端实现，无需安装任何后端环境即可使用。

## 基本功能
- 上传Excel文件，自动识别包含"词"的列
- 自动生成英式和美式音标
- 将结果导出为Excel文件（原表格基础上新增音标列）
- 无需登录即可使用
- 简洁易用的界面设计

## 如何使用

### 快速开始
1. 打开`index.html`文件（直接在浏览器中打开即可）
2. 拖拽要处理的Excel文件到上传区域，或点击上传区域选择文件
3. 等待处理完成（进度会显示在状态栏）
4. 点击"下载结果"按钮获取带音标的Excel文件

### 支持的Excel格式
- 文件必须包含一个带有单词/短语的列（通常列名为"词"）
- 支持.xlsx文件格式，最大10MB

## 工作原理

### 1. Excel文件格式与处理逻辑
- 处理逻辑：
  - **等号截断处理**：使用`split('=')[0]`提取等号前内容（如"she's = she is" → "she's"）
  - **空白字符规范化**：移除首尾空格/换行符，将连续多个空格压缩为单个空格
  - **分词处理**：所有包含空格的短语都会被分解为单独的单词，分别查询音标后再合并
  - **大小写标准化**：转为小写用于查询（但保留原始大小写）
  - **特殊符号过滤**：移除不影响发音的标点，保留必要符号（如撇号）

### 2. 音标获取方式
- 优先从本地词典查询音标（openDictUK.json和openDictUS.json）
- 本地查询不到时，检查浏览器缓存
- 缓存未命中时，从远端API获取并缓存结果
- 远端API查询失败时返回"Not Found"

### 3. 短语分词机制
- **检测空格**：系统检查输入中是否包含空格
- **执行分词**：所有含空格的输入都会被空格分割成多个单词
- **单独处理**：每个分词后的单词分别查询音标
- **合并结果**：从每个单词的音标中去除斜杠，用空格连接，然后在组合音标的开头和结尾添加斜杠
- **示例**：
  - "Good morning" → 分解为["good", "morning"] → 查询音标 → 合并为"/ɡʊd mɔːnɪŋ/"
  - "look after" → 分解为["look", "after"] → 查询音标 → 合并为"/lʊk ˈæftər/"

## 技术实现

### 前端技术栈
- HTML5 + CSS3 + JavaScript（纯前端实现）
- 使用原生拖拽API实现文件上传
- 使用SheetJS库处理Excel文件
- 使用原生Fetch API进行跨域API通信
- 使用CORS代理解决跨域问题
- 使用localStorage实现持久化缓存

### 单词处理流程
```
原始内容 → 检查是否含等号 → 提取等号前内容/保留原内容 → 检查是否含空格 
→ 分词处理 → 批量查询音标 → 音标合并
```

### 音标查询流程
```
查询请求 → 本地词典查询 → 浏览器缓存查询 → 远程API查询 → 结果返回与缓存
```

## 常见问题

### Q: 为什么有些单词显示"Not Found"？
A: 可能原因包括：
1. 该单词在API数据库中不存在
2. 远程API暂时不可用
3. 网络连接问题

### Q: 如何处理大量数据？
A: 本工具已优化为分批处理大量数据，并实现了缓存机制减少API请求。对于非常大的文件（>10MB），建议拆分成多个小文件处理。

### Q: API请求失败怎么办？
A: 工具内置了多个CORS代理服务器，会在一个代理失败时自动切换到下一个。如果所有代理都失败，可能是网络问题或API服务不可用，请稍后再试。

### Q: 短语如何处理？
A: 所有包含空格的短语（如"look after"、"a lot"等）都会被分解为独立单词，分别查询音标后再合并结果。这样能提高查询成功率，但音标结果可能与整体念法略有差异。

## 隐私说明
- 所有处理都在浏览器本地完成，不会上传您的Excel文件内容
- API请求仅发送单个单词，不会发送完整的数据集
- 查询结果会缓存在浏览器的localStorage中，可以通过清除浏览器数据删除

## 协议与声明
本项目使用的Free Dictionary API为公共资源，仅用于教育和非商业用途。

## 详细需求

### 1. Excel文件格式与处理逻辑
- 输入Excel文件只有一列，列名为"词"
- 每一行可能是单词、短句，可能存在大小写、标点符号、等号等
- 处理逻辑：
  - **等号截断处理**：使用`split('=')[0]`提取等号前内容（如"she's = she is" → "she's"）
  - **空白字符规范化**：移除首尾空格/换行符，将连续多个空格压缩为单个空格
  - **分词处理**：所有包含空格的短语都会被分解为单独的单词，分别查询音标后再合并
  - **大小写标准化**：转为小写用于查询（但保留原始大小写）
  - **特殊符号过滤**：移除不影响发音的标点，保留必要符号（如撇号）

### 2. 音标获取方式
- 优先从本地词典查询音标
- 本地查询不到时，检查缓存表
- 缓存未命中时，从远端API获取并缓存结果
- 远端API查询失败时返回"Not Found"

### 3. 界面设计

#### 3.1 界面布局
```
+-------------------------------------------+
|   Excel音标生成工具                       |
+-------------------+-----------------------+
| 上传区            | 预览区                |
|                   |                       |
| [拖拽文件到这里]  | 单词    美式   英式    |
| 或点击选择文件    |----------------       |
|                   | Hello /hə'lo/ /hɛ'ləʊ/|
+-------------------+-----------------------+
| [状态栏] 已加载：example.xlsx             |
| [下载按钮]                                |
+-------------------------------------------+
```

#### 3.2 界面组件

| 组件 | 功能说明 | 交互规则 |
| --- | --- | --- |
| 文件上传区 | 拖拽/点击上传Excel | 限制10MB以下.xlsx文件 |
| 结果预览区 | 展示前5行带音标的数据 | 高亮新增的音标列 |
| 错误提示框 | 列名错误/格式错误等 | 自动消失延时3秒 |
| 下载按钮 | 触发文件下载 | 保留原始文件名+_phonetics |

#### 3.3 现代化设计要求

- **全屏设计**：页面布局应完全利用浏览器窗口空间，呈现更专业的外观
- **现代UI风格**：
  - 采用类似Tailwind CSS的设计语言，注重简洁、功能性和一致性
  - 顶部使用醒目的导航条/标题区，采用深蓝色背景
  - 文件上传区使用虚线边框，突出显示拖拽区域
  - 结果呈现区域采用简洁的表格布局
  - 底部状态栏与功能按钮设计统一
- **响应式设计**：支持桌面和移动设备的不同屏幕尺寸
- **交互优化**：
  - 添加适当的动画效果，如文件上传时的进度展示
  - 文件处理结果的高亮效果
  - 清晰的状态反馈

### 4. 导出格式
- 在原Excel文件基础上新增两列：英式音标和美式音标
- 保留原始数据不变

### 5. 错误处理
- 找不到音标时显示"Not Found"
- Excel格式不正确时显示错误提示

## 技术实现流程

### 单词处理流程
```
原始内容 → 检查是否含等号 → 提取等号前内容/保留原内容 → 检查是否含空格 
→ 分词处理 → 批量查询音标 → 音标合并
```

### 音标查询流程
```
查询请求 → 本地词典查询 → 缓存表查询 → 远程API查询 → 结果返回与缓存
```

### 界面交互流程
```
选择文件 → 格式校验 → 显示加载动画 → 展示预览 → 启用下载按钮
```

## 技术方案

### 前端技术栈
- HTML5 + CSS3 + JavaScript（纯前端实现）
- 使用原生拖拽API实现文件上传
- 使用SheetJS库处理Excel文件
- 使用原生Fetch API进行后端通信
- 使用Tailwind CSS风格的设计理念

### 后端技术选择
- 简单HTTP服务器处理API请求
- SQLite本地数据库存储单词音标词典
- 使用缓存表减少对外部API的依赖

### 关键技术点
1. **Excel文件处理**：使用SheetJS库读取和生成Excel文件
2. **音标查询**：
   - 本地词典：预先加载的常用单词音标库
   - 远程API：在本地查询失败时调用
   - 缓存机制：减少重复API调用
3. **分词处理**：对包含多个单词的短语进行智能拆分
4. **用户体验优化**：
   - 加载提示与动画效果
   - 错误处理与反馈
   - 直观的界面设计
   - 全屏响应式布局

 